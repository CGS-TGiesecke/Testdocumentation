===== Registrierungsschritte in Microsoft Entra ID

1. Anmeldung unter https://entra.microsoft.com.
2. Neue Anwendung registrieren; Client ID, Tenant ID und ggf. Client Secret notieren.
3. Redirect URI hinterlegen (z. B. https://ihreapp.com/auth/callback).
4. Unter „API-Berechtigungen” mindestens die Berechtigungen „openid“ und „profile“ hinzufügen.

===== OpenID Connect Endpunkte

- *Authorization Endpoint:*  
https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize

- *Token Endpoint:* 
https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token

- *Issuer:*  
https://login.microsoftonline.com/{tenant}/v2.0

- *JWKS (Key Discovery):*  
https://login.microsoftonline.com/{tenant}/discovery/v2.0/keys

Ersetzen Sie `{tenant}` durch Ihre Tenant ID oder `common` (für Multi-Tenant-Szenarien).

===== OpenID Connect Authentication Flow

1. Die Anwendung leitet den Benutzer zum Authorization Endpoint (`/authorize`) um, inklusive Parameter:

  * client_id
  * response_type=code
  * redirect_uri
  * scope=openid profile email
  * state, nonce

2. Der Benutzer authentifiziert sich bei Microsoft Entra ID.
3. Entra ID leitet den Benutzer zu `redirect_uri` mit einem Authorization Code zurück.
4. Die Anwendung tauscht diesen Code am Token Endpoint gegen Token (ID Token, Access Token) ein.
5. Die Anwendung validiert das ID-Token (JWT) unter Zuhilfenahme des Issuer und JWKS.
6. Nach erfolgreicher Prüfung gilt der Benutzer als authentifiziert.

*Beispiel:* Authorization Request URL
```
https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize?
client_id={client_id}
&response_type=code
&redirect_uri={redirect_uri}
&scope=openid%20profile%20email
&state={state}
&nonce={nonce}
```
*Beispiel:* Token Request (POST)
```
POST an `https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token`

Body (x-www-form-urlencoded):
client_id={client_id}
grant_type=authorization_code
scope=openid profile email
code={authorization_code}
redirect_uri={redirect_uri}
client_secret={client_secret}
```

*Hinweise zur Implementierung*

* Verwenden Sie eine geprüfte Bibliothek für den OpenID-Connect-Flow (z.B. MSAL für .NET/JavaScript/Python/Java, oidc-client, o.ä.).
* Schützen Sie Ihr Client Secret – niemals im Client-Code (Browser, Mobile-App) verwenden.
* Validieren Sie stets das ID-Token (`id_token`) und prüfen Sie `nonce` und `state`.
* Legen Sie in der App-Registrierung ausschließlich vertrauenswürdige Redirect-URIs fest.
* Überprüfen Sie im ID-Token immer die Claims `aud` (audience) und `iss` (issuer).

===== Referenzen

* Microsoft Entra ID OpenID Connect Dokumentation  
  - https://learn.microsoft.com/de-de/azure/active-directory/develop/v2-protocols-oidc
* OpenID Connect Standard:
  - https://openid.net/connect/

===== Weitere Konfiguration
Passen Sie bei Bedarf die Scopes und Berechtigungen in Entra ID an, um weiteren Ressourcen-Zugriff (z.B. Microsoft Graph) zu ermöglichen. 
(siehe "Registrierung einer Anwendung im Microsoft Entra ID Admin Center")
