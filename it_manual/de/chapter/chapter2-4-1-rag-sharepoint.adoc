
==== Sharepoint Andindung über die Microsoft Entra ID (ehemals Azure Active Directory) gesicherte API

Die Anbindung von Sharepoint muss über eine API mit den Kundendaten erfolgen. 
In SharePoint werden einzelne Bereiche als Sites bezeichnet. Wenn z.B. eine neue Gruppe in MS Teams erstellt wird, erstellt SharePoint 
automatisch eine entsprechende SharePoint-Site, die mit dieser Gruppe verknüpft ist.

Die notwendigen Daten, für die Anbindung von {application} an Sharepoint des Kunden sind:

* **Tenant-ID:** Die ID des Mandanten, normalerweise eine GUID.
* **Client-ID:** Die Client-ID der Anwendung mit den erforderlichen Berechtigungen (Client-Secrets) für den Datenzugriff.
* **Client-Secrets:** Die SharePoint-Application-Berechtigungen für den Datenzugriff.

Diese werden in einen config file hinterlegt (siehe "Erstkonfiguration der Anwendung"). Sind diese Daten nicht vorhanden, 
muss die Applikation {application} vom Kunden erst in Microsoft Entra Admin Center registriert werden.

ifeval::[{big-output} == 1]

===== Registrierung einer Anwendung in Microsoft Entra ID

*Login*
Melden Sie sich im Microsoft Entra Admin Center mit einem Konto an, das über Administratorrechte für Ihre Organisation verfügt.

*Navigation zu "App-Registrierungen"*

* Wählen Sie im linken Menü "Identitätsverwaltung", dann "Azure Active Directory".
* Navigieren Sie zu "App-Registrierungen".
* Neue Anwendung registrieren
* Klicken Sie auf "Neue Registrierung" (oben im Menü).

*Anwendungsinformationen eingeben*

* Name: Wählen Sie einen Namen für die Anwendung.
* Unterstützte Kontotypen: Entscheiden Sie, ob die Anwendung nur interne Benutzer (nur eigene Organisation), externe Benutzer oder mehrere Organisationen unterstützen soll.
* Redirect URI (optional): Geben Sie eine Umleitungs-URL an, wenn Ihre Anwendung eine Authentifizierung benötigt.

*Erstellen*

* Klicken Sie auf "Registrieren".
* Nach der Registrierung erhalten Sie:

** Anwendungs-ID **(Client-ID)**
** Verzeichnis-ID **(Tenant-ID)**
** **Client-Secrets** oder Zertifikat je nach Bedarf unter "Zertifikate & Geheimnisse" generieren

**!!!Hinweis:** Kopieren Sie die Werte für Ihre Anwendungskonfiguration

*Berechtigungen konfigurieren (optional)*

* Unter "API-Berechtigungen" können Sie Ihrer Anwendung Zugriff auf Microsoft APIs (z.B. Microsoft Graph) gewähren.

*Weitere Einstellungen*

* Optional: Konfigurieren Sie Branding, Token-Konfiguration und User-Assignment je nach Bedarf.

endif::[]

==== Zugriff auf SharePoint-Inhalte über die Microsoft Graph API

Microsoft Graph API ist die zentrale Schnittstelle, über die programmatisch auf Microsoft 365-Dienste (wie SharePoint) zugegriffen wird.

**Ablauf:**

* OAuth 2.0 Authentifizierung:
** Die Anwendung holt sich über ein sogenanntes OAuth2-Grant-Flow ein Zugriffstoken von Entra ID.

* Aufruf der Graph API:
** Mit dem Token kann die Anwendung SharePoint-Inhalte über die Microsoft Graph API auslesen oder bearbeiten.

ifeval::[{big-output} == 1]

Um SharePoint-Ressourcen (z. B. Listen, Websites, Dateien) durch eine registrierte Anwendung im Microsoft Entra Admin Center abzudecken, sind folgende zusätzliche Schritte nötig:

**1. SharePoint-Berechtigungen definieren**
Ihre Anwendung benötigt passende Permissions, um auf SharePoint Online zugreifen zu dürfen. Dies wird über Microsoft Graph oder die direkte SharePoint API konfiguriert.

a) Hinzufügen von API-Berechtigungen
* Navigieren Sie zu Ihrer App-Registrierung:
* Entra Admin Center → Identität → Anwendungen → App-Registrierungen → Ihre Anwendung wählen.
* Klicken Sie auf „API-Berechtigungen“.
* Fügen Sie Berechtigungen hinzu:
** Klicken Sie auf "Berechtigung hinzufügen".
** Wählen Sie „Microsoft Graph“ (für modernen Zugriff, empfohlen); alternativ: „SharePoint“.
** Sie können Anwendungsberechtigungen („Application permissions“, für Dienste ohne User-Kontext) ODER Delegierte Berechtigungen („Delegated permissions“, im Kontext eines angemeldeten Benutzers) vergeben.

Typische SharePoint-Berechtigungen im Microsoft Graph:

Delegierte Berechtigungen:
```
Sites.Read.All
Sites.ReadWrite.All
```
Anwendungsberechtigungen:
```
Sites.FullControl.All
Sites.Read.All
Sites.ReadWrite.All
```

Typische SharePoint-spezifische Berechtigungen (direkt auf SharePoint-API):
```
AllSites.FullControl
AllSites.Read
AllSites.Write
````

Beispiel – Microsoft Graph Application Permission:
```
Sites.Read.All
Sites.ReadWrite.All
```

**2. Admin-Zustimmung erteilen**
Damit Ihre App mit diesen Permissions arbeiten kann, muss ein Mandanten-Administrator die Berechtigungen genehmigen:
In den API-Berechtigungen auf "Admin-Zustimmung für [Ihr Verzeichnis]" klicken.

**Wichtige Hinweise**
"Sites.FullControl.All" bzw. AllSites.FullControl gibt Zugriff auf alle SharePoint-Inhalte im Tenant.
Nutzen Sie solche Rechte nur mit besonderer Vorsicht und nur wenn unbedingt nötig!
Für produktive Systeme, Datenschutz- und Sicherheitsanforderungen konsultieren Sie bitte qualifizierte Audit- oder Datenschutzbeauftragte.

endif::[]