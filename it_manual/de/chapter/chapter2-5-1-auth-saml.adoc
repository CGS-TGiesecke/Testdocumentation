
==== SAML-Authentifizierung mit Microsoft Entra ID

Diese Dokumentation beschreibt die Integration von SAML 2.0-Authentifizierung mit Microsoft Entra ID (ehemals Azure Active Directory) 
als Identitätsprovider (IdP) zur Absicherung von {application}.

==== Voraussetzungen

* Ein Microsoft Entra ID (Azure AD) Mandant und Zugriff auf das Microsoft Entra Admin Center: https://entra.microsoft.com
* Eine als „Unternehmensanwendung“ (**Enterprise Application**) registrierte Applikation
* Unterstützung von SAML 2.0 in der Zielanwendung ({application})
* Zugriff auf die SAML-Metadaten oder Konfigurationsendpunkte des Service Providers (SP)

==== Registrierung/Einrichtung in Microsoft Entra ID

1. Anmeldung im Entra Admin Center: https://entra.microsoft.com
2. Navigieren zu **Identität > Anwendungen > Unternehmensanwendungen**.
3. Auswahl von **+Neue Anwendung** und **Eigene Anwendung integrieren** → **Mit beliebiger anderen Anwendung (SAML, …)**
4. Namen vergeben (z.B. {application}) und erstellen.

==== SAML-Basisdaten in Entra ID konfigurieren

Unter **Einmaliges Anmelden (Single Sign-On) > SAML** müssen folgende Eigenschaften konfiguriert werden:

* *Bezeichner (Entity ID)*:  
  Die eindeutige Kennung des Service Providers – meist eine URL.
* **Antwort-URL (Assertion Consumer Service URL)**:  
  Endpoint, an den das SAML Assertion Response gesendet wird (vom SP vorgegeben).
* *Anmelde-URL (optional)*:  
  Login-Adresse Ihrer Anwendung, falls vom SP genutzt.

*Tipp:* Diese Werte finden Sie in den Metadaten Ihrer Anwendung/SAML-SP.

==== Benutzer-Zuordnung & Attribute

* Unter *Benutzer und Gruppen* können berechtigte Benutzer/Gruppen ausgewählt werden.
* Im SAML-Konfigurationsbereich → *Attribute & Ansprüche* können Standard- und benutzerdefinierte Claims zugeordnet werden, z.B.:
  * `user.principalname` als NameID
  * Optionale Gruppen-, Rollen- oder E-Mail-Attribute

==== SAML-IdP-Konfigurationsdaten (Bereitstellung für den SP)

Nach dem Speichern der SAML-Konfiguration stellt Microsoft Entra ID die IdP-Metadaten zur Verfügung, u.a.:

* *Anmelde-URL (SAML Redirect/POST SSO URL)*
* *Azure AD Identifier (Issuer/Entity ID)*
* *SAML Signatur-Zertifikat* (als Datei und/oder Base64)

Diese Daten importieren Sie in Ihre Anwendung oder SAML-Service-Provider-Konfiguration.

*Beispiel Endpunkte (Azure Standard):*

* Anmelde-URL (SSO): https://login.microsoftonline.com/{tenantid}/saml2
* Identitätsanbieter-ID: https://login.microsoftonline.com/{tenantid}/v2.0
* X.509-Zertifikat: Im Portal herunterladen

==== SAML-Ablauf

1. Der Benutzer wählt SSO („Mit Microsoft anmelden“) in {application}.
2. {application} generiert eine SAML Authentication Request und leitet den Benutzer zum Microsoft Entra ID SAML-Endpunkt um.
3. Der Benutzer authentifiziert sich (ggf. MFA, falls verlangt).
4. Entra ID stellt dem Benutzer, nach erfolgreicher Prüfung, eine signierte SAML Assertion aus und leitet ihn zurück zu {application} (Assertion Consumer Service URL).
5. {application} prüft und verarbeitet die Assertion und meldet den Benutzer an.

==== Sicherheitshinweise

* Sichern Sie die ACS- und Entity-ID-Adressen gegen unbefugten Zugriff ab.
* Nutzen Sie für Assertion/Response stets HTTPS.
* Nutzen Sie aktuelle Zertifikate zum Signieren und Validieren.
* Die Zuordnung von Claims/Attributen sollte dem Principle of Least Privilege (PoLP) folgen.

==== Referenzen

* Microsoft-Dokumentation SAML/Einstellungen  
  - https://learn.microsoft.com/de-de/azure/active-directory/manage-apps/configure-single-sign-on-non-gallery-applications
* SAML 2.0 Standard: https://docs.oasis-open.org/security/saml/v2.0/saml-core-2.0-os.pdf

==== Weitere Hinweise

* Die Einrichtung kann je nach SP variieren (Spezialfelder, Attribute).
* Für produktive Setups und Datenschutzthemen ziehen Sie einen qualifizierten Audit- oder Datenschutzbeauftragten hinzu.